<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul  id="list" class="comments">

      </ul>
      <div class="add-form">
        <input minlength="1" maxlength="25" id="name-input"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea minlength="1" maxlength="35" id="comment-input"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row" id="add-button">
          <button id="add-button" class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <style>
    .error {
      background-color: rgb(196, 84, 84);
    }

    .active-like {
      background-image: url("data:image/svg+xml,%3Csvg width='22' height='20' viewBox='0 0 22 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15.95 0C14.036 0 12.199 0.882834 11 2.26703C9.801 0.882834 7.964 0 6.05 0C2.662 0 0 2.6267 0 5.99455C0 10.1035 3.74 13.4714 9.405 18.5613L11 20L12.595 18.5613C18.26 13.4714 22 10.1035 22 5.99455C22 2.6267 19.338 0 15.95 0Z' fill='%23BCEC30'/%3E%3C/svg%3E")
    }

  </style>
  <script>


const comments = [
    {
        name: 'Глеб Фокин',
        date: "12.02.22 12:18",
        comment: 'Это будет первый комментарий на этой странице',
        likes: 3,
        islike: false
    },
    {
        name: 'Варвара Н',
        date: "13.02.22 19:22",
        comment: 'Мне нравится как оформлена эта страница! ❤',
        likes: 75,
        islike: true
    }
];

function renderElements (){
    const commentsHTML = comments.map((element, index)=>{
        return `<li class="comment" data-index="${index}" >
        <div class="comment-header">
          <div>${element.name}</div>
          <div>${element.date}</div>
        </div>
        <div class="comment-body">
          <div class="comment-text">
            ${element.comment}
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">${element.likes}</span>
            <button data-index="${index}" class="like-button ${element.islike ? "-active-like" : ""}"></button>
            
          </div>
        </div>
        <button data-index="${index}" class="add-form-button delete-button">Удалить</button>
      </li>`
      
    }).join("");
    list.innerHTML = commentsHTML;
    addLike();
    commentOnComment();
    deleteComment();
}
renderElements();
function addLike () {
  const likeElements = document.querySelectorAll('.like-button');
  for(let like of likeElements) {
    like.addEventListener('click', (event) => { 
      event.stopPropagation();
      let index = like.dataset.index 
      let object = comments[index];
      if (object.islike){
        object.islike = false;
        object.likes --;
      } else {
        object.islike = true;
        object.likes ++;
      }
      renderElements();
    })
  }

}

 

 
const buttonElement = document.getElementById("add-button");
const listElement = document.getElementById("list");
const nameInputElement = document.getElementById("name-input");
const commentInputElement = document.getElementById("comment-input");
const currentDate = new Date ().toLocaleString().slice(0, -3);


buttonElement.addEventListener("click", () => {

nameInputElement.classList.remove("error");
commentInputElement.classList.remove("error");

if (nameInputElement.value === "" || commentInputElement.value === "") {

  nameInputElement.classList.add("error");
  commentInputElement.classList.add("error");
  return;
}
comments.push({
        name: nameInputElement.value,
        date: currentDate,
        comment: commentInputElement.value,
        likes: 0,
        islike: false
      });
      renderElements();
});
addComment();

function addComment () {

buttonElement.addEventListener('click', () => {
  nameInputElement.classList.remove("error");
  commentInputElement.classList.remove("error");
   if (nameInputElement.value === '' || commentInputElement.value === '') {
    nameInputElement.classList.add("error");
    commentInputElement.classList.add("error");
    return;
   };

  renderElements();
  nameInputElement.value = "";
  commentInputElement.value = "";
  });
  
};


function deleteComment () {
const buttonDelete = document.querySelectorAll('.delete-button');
for( let button of buttonDelete) {
  button.addEventListener('click', (event) => {
    let index = button.dataset.index;
    comments.splice(index, 1);
    event.stopPropagation();
   renderElements();
  })
}
  
};

function commentOnComment() {
    const commentOnComment = document.querySelectorAll('.comment');
     for(let comment of commentOnComment) {
     comment.addEventListener('click', () => {
       let index = comment.dataset.index;
     let object = comments[index];
      commentInputElement.value = `${object.comment}  ${object.name}`;
     renderElements();
     });
    
    };
 };

  </script>
</html>
